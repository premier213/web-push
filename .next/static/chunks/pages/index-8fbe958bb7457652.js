(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{3098:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return t(3130)}])},3130:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return b},pusher:function(){return h}});var r=t(7135),i=t(9938),o=t(1527),c=t(959),s=t(5665),u=t.n(s),a=t(6338).Z.create({baseURL:"https://tjmkk.com/api",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer 219|pF1XeLx86dlua93Sb4vkKtze5skVsDvPlNU5TV6se09eff20"}}),l=t(5830),f=function(e){for(var n=(e+"=".repeat((4-e.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),t=window.atob(n),r=new Uint8Array(t.length),i=0;i<t.length;++i)r[i]=t.charCodeAt(i);return r},p="socket.tjmkk.com",h=new(t.n(l)())("56d56355b6cc996b754bab712e42aae6",{cluster:"mt1",httpHost:p,httpPort:Number(6002),wsHost:p,wsPort:Number(6002),authorizer:function(e){return{authorize:function(n,t){a.post("/broadcasting/auth",{socket_id:n,channel_name:e.name}).then((function(e){return t(null,e.data)})).catch((function(e){return t(new Error("Error occurred"),e)}))}}}}),b=function(){var e,n=(0,c.useState)(!1),t=n[0],s=n[1],a=(0,c.useState)(null),l=a[0],p=a[1],b=(0,c.useState)(null),d=b[0],g=b[1];(0,c.useEffect)((function(){"serviceWorker"in navigator&&window.addEventListener("load",(function(){navigator.serviceWorker.register("/sw.js").then((function(e){console.log("Service Worker registered with scope:",e.scope)})).catch((function(e){console.error("Service Worker registration failed:",e)}))}))}),[]);var v=function(){var n=(0,r.Z)((function(){return(0,i.__generator)(this,(function(n){switch(n.label){case 0:return console.log("\ud83c\udfaf #68-pages/index.tsx",e),[4,fetch("/api/notification",{method:"POST",headers:{"Content-type":"application/json"},body:JSON.stringify({subscription:e})})];case 1:return n.sent(),[2]}}))}));return function(){return n.apply(this,arguments)}}();(0,c.useEffect)((function(){h.subscribe("private-rates.1").bind("rates.update.price",function(){var e=(0,r.Z)((function(e){return(0,i.__generator)(this,(function(e){switch(e.label){case 0:return"granted"!==Notification.permission?[3,2]:[4,v()];case 1:e.sent(),e.label=2;case 2:return[2]}}))}));return function(n){return e.apply(this,arguments)}}())}),[]),(0,c.useEffect)((function(){"serviceWorker"in navigator&&void 0!==window.workbox&&navigator.serviceWorker.ready.then((function(n){n.pushManager.getSubscription().then((function(n){console.log("\ud83c\udfaf #1060000000000000000-pages/index.tsx",n),!n||n.expirationTime&&Date.now()>n.expirationTime-3e5||(console.log("\ud83c\udfaf #index.tsx",n),e=n,s(!0))})),g(n)}))}),[]);var w=function(){var e=(0,r.Z)((function(e){var n;return(0,i.__generator)(this,(function(t){switch(t.label){case 0:return e.preventDefault(),[4,d.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:f("BOGx_KFrFsYBkj5BwrLkmszjGOUOpaXAxA4ppMLDQ-ZMmQZs68p4J29Snq_QV8ihOcWf-88BGYc9OIThfi4iFFc")})];case 1:return n=t.sent(),console.log("\ud83d\ude80 ~ subscribeButtonOnClick ~ sub:",n),p(n),s(!0),console.log("web push subscribed!"),console.log(n),[2]}}))}));return function(n){return e.apply(this,arguments)}}(),_=function(){var e=(0,r.Z)((function(e){return(0,i.__generator)(this,(function(n){switch(n.label){case 0:return e.preventDefault(),[4,l.unsubscribe()];case 1:return n.sent(),p(null),s(!1),console.log("web push unsubscribed!"),[2]}}))}));return function(n){return e.apply(this,arguments)}}(),k=function(){var e=(0,r.Z)((function(e){return(0,i.__generator)(this,(function(e){return[2]}))}));return function(n){return e.apply(this,arguments)}}();return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(u(),{children:(0,o.jsx)("title",{children:"next-pwa example"})}),(0,o.jsx)("h1",{children:"Next.js + PWA = AWESOME!"}),(0,o.jsx)("button",{onClick:w,disabled:t,children:"Subscribe"}),(0,o.jsx)("button",{onClick:_,disabled:!t,children:"Unsubscribe"}),(0,o.jsx)("button",{onClick:k,disabled:!t,children:"Send Notification"})]})}}},function(e){e.O(0,[774,932,888,179],(function(){return n=3098,e(e.s=n);var n}));var n=e.O();_N_E=n}]);